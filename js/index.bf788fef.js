import{_ as v}from"./index.0d50e148.js";import{ah as i,o as u,c as h,V as t,P as n,a as p,T as w,U as b,F as $,a8 as V,O as y,S as O,ar as R,a9 as E,Q as H}from"./vendor-vue.9e61e0af.js";import{F as D}from"./vendor-lib.e5a529ac.js";import{H as F,a as L}from"./highlight-lib.3654f6d3.js";import"./element-icon.1ce1c350.js";import"./element-plus.6ad5b531.js";const B={domains:[{message:"\u57DF\u540D\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],status:[{message:"\u9A8C\u8BC1\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],start_time:[{message:"SSL\u7B7E\u53D1\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],expire_time:[{message:"SSL\u8FC7\u671F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],create_time_label:[{message:"\u521B\u5EFA\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},I={name:"",props:{row:{type:Object,default:null}},components:{},data(){return{rules:B,form:{domains:"",status:"",start_time:"",expire_time:"",create_time_label:""}}},computed:{},methods:{async getData(){if(this.row){let l={id:this.row.id};const e=await this.$http.function(l);if(e.code!=0)return;let s=e.data;this.form.domains=s.domains,this.form.status=s.status,this.form.start_time=s.start_time,this.form.expire_time=s.expire_time,this.form.create_time_label=s.create_time_label}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(l=>{if(l)this.confirmSubmit();else return!1})},async confirmSubmit(){let l=this.$loading({fullscreen:!0}),e={domains:this.form.domains.split(`
`)};this.row&&(e.id=this.row.id);const s=await this.$http.issueCertificate(e);s.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success",s.data)):this.$msg.error(s.msg),this.$nextTick(()=>{l.close()})}},created(){this.getData()}},U={class:"text-center"};function j(l,e,s,C,a,o){const r=i("el-input"),c=i("el-form-item"),_=i("el-form"),d=i("el-button");return u(),h("div",null,[t(_,{ref:"form",model:a.form,rules:a.rules,"label-width":"100px"},{default:n(()=>[t(c,{label:"id",prop:"id",style:{display:"none"}},{default:n(()=>[t(r,{type:"text",modelValue:a.form.id,"onUpdate:modelValue":e[0]||(e[0]=f=>a.form.id=f),placeholder:"id"},null,8,["modelValue"])]),_:1}),t(c,{label:"\u57DF\u540D\u5217\u8868",prop:"domains"},{default:n(()=>[t(r,{type:"textarea",modelValue:a.form.domains,"onUpdate:modelValue":e[1]||(e[1]=f=>a.form.domains=f),rows:5,placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D\u5217\u8868\uFF0C\u6BCF\u884C\u4E00\u4E2A"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),p("div",U,[t(d,{onClick:o.handleCancel},{default:n(()=>[w("\u53D6 \u6D88")]),_:1},8,["onClick"]),t(d,{type:"primary",onClick:o.handleSubmit},{default:n(()=>[w("\u786E \u5B9A")]),_:1},8,["onClick"])])])}const A=v(I,[["render",j]]);const z={name:"VerifyStep",props:{form:{type:Object}},components:{},data(){return{}},computed:{domain_list(){return this.form.domains.join(" ")},nginxConfig(){return`server {
  listen 80;
  server_name ${this.domain_list};

  location /.well-known/acme-challenge/ {
      alias /var/www/challenges/;
      try_files $uri =404;
  }
}`}},methods:{async getData(){},async handleSubmit(){let l=this.$loading({fullscreen:!0}),e={issue_certificate_id:this.form.id};const s=await this.$http.verifyCertificateById(e);s.code==0?(this.$msg.success("\u9A8C\u8BC1\u6210\u529F"),this.$emit("on-success",s.data)):this.$msg.error(s.msg),this.$nextTick(()=>{l.close()})},downloadVerifyFile(){let l=new Blob([this.form.validation],{type:"application/octet-stream;charset=utf-8"});D.saveAs(l,this.form.token)}},mounted(){F.highlightAll()},created(){this.getData()}},M={class:"mo-form-detail"},N={class:"verify-step__value"},P={class:"verify-step__value"},q=["href"],K={style:{padding:"10px 0","overflow-x":"auto",width:"100%"}},G=["innerHTML"],J={class:"text-center mt-md"};function W(l,e,s,C,a,o){const r=i("Download"),c=i("el-icon"),_=i("el-link"),d=i("el-form-item"),f=i("el-form"),S=i("el-button");return u(),h("div",M,[t(f,{"label-width":"130px"},{default:n(()=>[t(d,{label:"\u9A8C\u8BC1\u6587\u4EF6",prop:"domain"},{default:n(()=>[t(_,{underline:!1,type:"primary",class:"mr-sm",onClick:o.downloadVerifyFile},{default:n(()=>[t(c,null,{default:n(()=>[t(r)]),_:1}),w("\u70B9\u51FB\u4E0B\u8F7D")]),_:1},8,["onClick"])]),_:1}),t(d,{label:"\u6587\u4EF6\u5185\u5BB9",prop:"create_time"},{default:n(()=>[p("span",N,b(s.form.validation),1)]),_:1}),t(d,{label:"\u670D\u52A1\u5668\u76EE\u5F55",prop:"create_time"},{default:n(()=>[p("span",P,"/.well-known/acme-challenge/"+b(s.form.token),1)]),_:1}),t(d,{label:"HTTP\u5730\u5740",prop:"isp"},{default:n(()=>[(u(!0),h($,null,V(s.form.domain_validation_urls,g=>(u(),h("div",null,[p("a",{href:g,class:"verify-step__value mo-link",target:"_blank"},b(g),9,q)]))),256))]),_:1}),t(d,{label:"Nginx\u914D\u7F6E",prop:"isp"},{default:n(()=>[p("div",K,[p("pre",null,[p("code",{innerHTML:o.nginxConfig},null,8,G)])])]),_:1})]),_:1}),p("div",J,[t(S,{type:"primary",onClick:o.handleSubmit},{default:n(()=>[w("\u9A8C \u8BC1")]),_:1},8,["onClick"])])])}const Q=v(z,[["render",W],["__scopeId","data-v-1fbf3592"]]);L.addPlugin({"before:highlightBlock":({el:l,result:e})=>{console.log("before:highlightBlock")},"after:highlightElement":({el:l,result:e})=>{console.log("after:highlightElement")},"after:highlight":l=>{}});const X=L.highlight;const Y={name:"VerifyStep",props:{form:{type:Object}},components:{},data(){return{nginxConfigTemplate:`server {
    listen 443 ssl;
    server_name ${this.form.domain_list};

    ssl_certificate /path/to/${this.form.domains[0]}.pem;
    ssl_certificate_key /path/to/${this.form.domains[0]}.key;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_session_cache shared:SSL:50m;
    ssl_dhparam /path/to/server.dhparam;
    ssl_prefer_server_ciphers on;
}`}},computed:{domain_list(){return this.form.domains.join(" ")},nginxConfig(){return X(this.nginxConfigTemplate,{language:"nginx"}).value}},methods:{async getData(){},handleClose(){this.$emit("on-close")},async handleSubmit(){let l=this.$loading({fullscreen:!0}),e={issue_certificate_id:this.form.id};const s=await this.$http.renewCertificate(e);return s.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success",s.data)):this.$msg.error(s.msg),this.$nextTick(()=>{l.close()}),s},downloadSSLKeyFile(){console.log(JSON.stringify(this.form,null,2));let l=new Blob([this.form.ssl_certificate_key],{type:"text/plain;charset=utf-8"}),e=this.form.domains[0];D.saveAs(l,`${e}.key`)},async downloadSSLFile(){if(!this.form.ssl_certificate){const s=await this.handleSubmit();this.form.ssl_certificate=s.data.ssl_certificate}let l=new Blob([this.form.ssl_certificate],{type:"text/plain;charset=utf-8"}),e=this.form.domains[0];D.saveAs(l,`${e}.pem`)}},mounted(){F.highlightAll()},created(){this.getData()}},Z={class:"mo-form-detail"},ee={style:{padding:"10px 0","overflow-x":"auto"}},te=["innerHTML"],se={class:"text-center mt-md"};function ne(l,e,s,C,a,o){const r=i("Download"),c=i("el-icon"),_=i("el-link"),d=i("el-form-item"),f=i("el-form"),S=i("el-button");return u(),h("div",Z,[t(f,{"label-width":"130px"},{default:n(()=>[t(d,{label:"\u79C1\u94A5",prop:"domain"},{default:n(()=>[t(_,{underline:!1,type:"primary",class:"mr-sm",onClick:o.downloadSSLKeyFile},{default:n(()=>[t(c,null,{default:n(()=>[t(r)]),_:1}),w("\u70B9\u51FB\u4E0B\u8F7D")]),_:1},8,["onClick"])]),_:1}),t(d,{label:"\u516C\u94A5",prop:"domain"},{default:n(()=>[t(_,{underline:!1,type:"primary",class:"mr-sm",onClick:o.downloadSSLFile},{default:n(()=>[t(c,null,{default:n(()=>[t(r)]),_:1}),w("\u70B9\u51FB\u4E0B\u8F7D")]),_:1},8,["onClick"])]),_:1}),t(d,{label:"Nginx\u914D\u7F6E",prop:"domain"},{default:n(()=>[p("div",ee,[p("pre",null,[p("code",{innerHTML:o.nginxConfig},null,8,te)])])]),_:1})]),_:1}),p("div",se,[t(S,{type:"primary",onClick:o.handleClose},{default:n(()=>[w("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const le=v(Y,[["render",ne],["__scopeId","data-v-047a985f"]]),ie={name:"IssueCertificateStep",props:{row:{type:Object}},components:{DataForm:A,VerifyStep:Q,RenewStep:le},data(){return{activeStep:0,issue_certificate_id:null,form:{id:null,domains:[],domain_validation_urls:[],validation:"",token:"",status:"",ssl_certificate_key:"",ssl_certificate:""},setpList:[{title:"\u586B\u5199\u57DF\u540D"},{title:"\u90E8\u7F72\u9A8C\u8BC1\u6587\u4EF6"},{title:"\u4E0B\u8F7D\u8BC1\u4E66"}]}},computed:{},methods:{async getData(){if(!this.issue_certificate_id)return;let l={issue_certificate_id:this.issue_certificate_id};const e=await this.$http.getIssueCertificateById(l);if(!!e.ok){for(let s in this.form)this.form[s]=e.data[s];e.data.ssl_certificate?this.activeStep=3:e.data.status=="valid"?this.activeStep=2:e.data.status=="pending"?this.activeStep=1:this.activeStep=0}},handleIssueSuccess(l){this.issue_certificate_id=l.id,this.getData()},handleVerifySuccess(){this.getData()}},created(){this.row&&(this.issue_certificate_id=this.row.id),this.getData()}},ae={class:""},oe={class:"mt-md"};function re(l,e,s,C,a,o){const r=i("el-step"),c=i("el-steps"),_=i("el-divider"),d=i("DataForm"),f=i("VerifyStep"),S=i("RenewStep");return u(),h("div",ae,[t(c,{active:a.activeStep,"align-center":"","finish-status":"success"},{default:n(()=>[(u(!0),h($,null,V(a.setpList,g=>(u(),y(r,{title:g.title},null,8,["title"]))),256))]),_:1},8,["active"]),t(_),p("div",oe,[a.activeStep==0?(u(),y(d,{key:0,onOnSuccess:o.handleIssueSuccess,onOnCancel:e[0]||(e[0]=g=>l.$emit("on-cancel"))},null,8,["onOnSuccess"])):a.activeStep==1?(u(),y(f,{key:1,form:a.form,onOnSuccess:o.handleVerifySuccess},null,8,["form","onOnSuccess"])):a.activeStep==2||a.activeStep==3?(u(),y(S,{key:2,form:a.form,onOnClose:e[1]||(e[1]=g=>l.$emit("on-cancel"))},null,8,["form"])):O("",!0)])])}const ce=v(ie,[["render",re]]),de={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:A,IssueCertificateStep:ce},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u7533\u8BF7SSL\u8BC1\u4E66"},dialogVisible:{get(){return this.visible},set(l){this.$emit("update:visible",l)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function ue(l,e,s,C,a,o){const r=i("IssueCertificateStep"),c=i("el-dialog");return u(),y(c,{title:"\u7533\u8BF7SSL\u8BC1\u4E66",modelValue:o.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=_=>o.dialogVisible=_),width:"900px",center:"","append-to-body":""},{default:n(()=>[o.dialogVisible?(u(),y(r,{key:0,row:s.row,onOnCancel:o.handleClose,onOnSuccess:o.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):O("",!0)]),_:1},8,["modelValue"])}const T=v(de,[["render",ue]]),_e={name:"ConnectStatus",props:{value:{type:Boolean,default:!1}},emits:["on-click"],components:{},data(){return{}},computed:{},methods:{async getData(){},handleClick(){this.$emit("on-click")}},created(){}};function me(l,e,s,C,a,o){const r=i("SuccessFilled"),c=i("el-icon"),_=i("el-link"),d=i("CircleCloseFilled"),f=i("WarningFilled");return s.value==!0?(u(),y(_,{key:0,underline:!1,type:"success",onClick:o.handleClick},{default:n(()=>[t(c,null,{default:n(()=>[t(r)]),_:1})]),_:1},8,["onClick"])):s.value==!1?(u(),y(_,{key:1,underline:!1,type:"danger",onClick:o.handleClick},{default:n(()=>[t(c,null,{default:n(()=>[t(d)]),_:1})]),_:1},8,["onClick"])):(u(),y(_,{key:2,underline:!1,type:"warning",onClick:o.handleClick},{default:n(()=>[t(c,null,{default:n(()=>[t(f)]),_:1})]),_:1},8,["onClick"]))}const pe=v(_e,[["render",me]]),fe={name:"",components:{DataFormDialog:T,ConnectStatus:pe},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(l){this.currentRow=l,this.dialogVisible=!0},async handleDeleteClick(l){let e={id:l.id};const s=await this.$http.function(e);s.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(s.msg)},async handleStatusChange(l){let e={id:l.id};const s=await this.$http.function(e);s.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(s.msg)},handleUpdateSuccess(){this.$emit("on-success")}},created(){}},he={style:{"margin-left":"4px"}};function ge(l,e,s,C,a,o){const r=i("el-table-column"),c=i("ConnectStatus"),_=i("Tickets"),d=i("el-icon"),f=i("el-link"),S=i("el-table"),g=i("DataFormDialog");return u(),h("div",null,[t(S,{data:s.list,stripe:"",border:""},{default:n(()=>[t(r,{label:"ID",align:"center",prop:"id",width:"60"},{default:n(m=>[p("span",null,b(m.row.id||"-"),1)]),_:1}),t(r,{label:"\u57DF\u540D","header-align":"center",align:"center",prop:"domains"},{default:n(m=>[(u(!0),h($,null,V(m.row.domains,x=>(u(),h("div",null,b(x),1))),256))]),_:1}),t(r,{label:"\u9A8C\u8BC1\u72B6\u6001","header-align":"center",align:"center",prop:"status",width:"80"},{default:n(m=>[t(c,{value:m.row.show_status,onOnClick:x=>l.handleShowAddressListgDialog(m.row)},null,8,["value","onOnClick"]),p("span",he,b(m.row.status_label||"-"),1)]),_:1}),t(r,{label:"SSL\u7B7E\u53D1\u65F6\u95F4","header-align":"center",align:"center",prop:"start_time",width:"160"},{default:n(m=>[p("span",null,b(m.row.start_time||"-"),1)]),_:1}),t(r,{label:"SSL\u8FC7\u671F\u65F6\u95F4","header-align":"center",align:"center",prop:"expire_time",width:"160"},{default:n(m=>[p("span",null,b(m.row.expire_time||"-"),1)]),_:1}),t(r,{label:"\u521B\u5EFA\u65F6\u95F4","header-align":"center",align:"center",prop:"create_time_label"},{default:n(m=>[p("span",null,b(m.row.create_time_label||"-"),1)]),_:1}),t(r,{label:"\u67E5\u770B",width:"60","header-align":"center",align:"center"},{default:n(m=>[t(f,{underline:!1,type:"primary",onClick:x=>o.handleEditRow(m.row)},{default:n(()=>[t(d,null,{default:n(()=>[t(_)]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(g,{visible:a.dialogVisible,"onUpdate:visible":e[0]||(e[0]=m=>a.dialogVisible=m),row:a.currentRow,onOnSuccess:o.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"])])}const Se=v(fe,[["render",ge]]),be={name:"issue-certificate-list",props:{},components:{DataFormDialog:T,DataTable:Se},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,dialogVisible:!1}},computed:{},methods:{resetData(){this.page=1,this.getData()},async getData(){this.loading=!0;let l={page:this.page,size:this.size,keyword:this.keyword};try{const e=await this.$http.getCertificateList(l);e.code==0&&(this.list=e.data.list.map(s=>(s.show_status=null,s.status_label="\u672A\u77E5",s.status=="pending"?(s.show_status=!1,s.status_label="\u672A\u9A8C\u8BC1"):s.status=="valid"&&(s.show_status=!0,s.status_label="\u5DF2\u9A8C\u8BC1"),s)),this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()}},created(){this.getData()}},ye={class:"app-container"},we={class:"margin-bottom--20"};function ve(l,e,s,C,a,o){const r=i("Plus"),c=i("el-icon"),_=i("el-button"),d=i("Search"),f=i("el-input"),S=i("DataTable"),g=i("el-pagination"),m=i("DataFormDialog"),x=R("loading");return u(),h("div",ye,[p("div",we,[t(_,{type:"primary",onClick:o.handleAddRow},{default:n(()=>[t(c,null,{default:n(()=>[t(r)]),_:1}),w("\u7533\u8BF7")]),_:1},8,["onClick"]),t(f,{class:"ml-sm",style:{width:"260px"},modelValue:a.keyword,"onUpdate:modelValue":e[0]||(e[0]=k=>a.keyword=k),placeholder:"\u8F93\u5165\u57DF\u540D",clearable:"",onKeypress:E(o.handleSearch,["enter"]),onClear:o.handleSearch},{append:n(()=>[t(_,{onClick:o.handleSearch},{default:n(()=>[t(c,null,{default:n(()=>[t(d)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),H(t(S,{class:"mt-md",list:a.list,onOnSuccess:o.resetData,onOnEditRow:l.handleEditRow},null,8,["list","onOnSuccess","onOnEditRow"]),[[x,a.loading]]),t(g,{class:"mt-md justify-center",background:"",layout:"total, prev, pager, next",total:a.total,"page-size":a.size,"onUpdate:pageSize":e[1]||(e[1]=k=>a.size=k),"current-page":a.page,"onUpdate:currentPage":e[2]||(e[2]=k=>a.page=k),onCurrentChange:o.getData},null,8,["total","page-size","current-page","onCurrentChange"]),t(m,{visible:a.dialogVisible,"onUpdate:visible":e[3]||(e[3]=k=>a.dialogVisible=k),onOnSuccess:o.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const Oe=v(be,[["render",ve]]);export{Oe as default};
